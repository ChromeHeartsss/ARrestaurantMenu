<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Test with Plane Detection</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/AR.js@1.7.2/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; }
        a-scene { height: 100vh; }
    </style>
</head>
<body>
    <a-scene embedded arjs='sourceType: webcam;'>
        <!-- Камера для AR -->
        <a-camera></a-camera>

        <!-- Куб, который будет отображаться на плоскости -->
        <a-box id="box" position="0 0 -2" rotation="0 0 0" color="red"></a-box>

        <!-- Плоскость для AR-детектора -->
        <a-entity id="ar-plane" geometry="primitive: plane; width: 1; height: 1" material="color: blue; opacity: 0.5" visible="false"></a-entity>
    </a-scene>

    <script>
        AFRAME.registerComponent('plane-detector', {
            init: function () {
                var sceneEl = document.querySelector('a-scene');
                var boxEl = document.querySelector('#box');
                var arPlaneEl = document.querySelector('#ar-plane');

                var arController = sceneEl.systems['arjs'].arController;

                arController.addEventListener('load', function () {
                    arController.addEventListener('update', function () {
                        var detectedPlanes = arController.getDetectedPlanes();

                        if (detectedPlanes.length > 0) {
                            var planeData = detectedPlanes[0];
                            var position = planeData.position;
                            var rotation = planeData.rotation;

                            // Позиционируем плоскость на найденной плоскости
                            arPlaneEl.object3D.position.set(position.x, position.y, position.z);
                            arPlaneEl.object3D.rotation.set(rotation.x, rotation.y, rotation.z);
                            arPlaneEl.setAttribute('visible', 'true');

                            // Позиционируем куб на плоскости
                            boxEl.setAttribute('position', `${position.x} ${position.y + 0.5} ${position.z}`);
                        } else {
                            arPlaneEl.setAttribute('visible', 'false');
                        }
                    });
                });
            }
        });

        // Регистрация компонента перед сценой
        document.querySelector('a-scene').setAttribute('plane-detector', '');
    </script>
</body>
</html>
